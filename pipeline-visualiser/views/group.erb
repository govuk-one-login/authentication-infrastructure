<%= erb :'partials/breadcrumbs', :locals => {breadcrumbs: breadcrumbs } %>

<span class="govuk-caption-l">Group</span>
<h1 class="govuk-heading-l"><%= view.name %></h1>

<h2 class="govuk-heading-m">Pipelines</h2>
<table class="govuk-table">
  <caption class="govuk-table__caption govuk-visually-hidden">Pipelines</caption>
  <thead class="govuk-table__head">
  <tr class="govuk-table__row">
    <th scope="col" class="govuk-table__header">Name</th>
    <th scope="col" class="govuk-table__header">State</th>
    <th scope="col" class="govuk-table__header">Stage</th>
    <th scope="col" class="govuk-table__header">Last run</th>
  </tr>
  </thead>
  <tbody class="govuk-table__body">
  <% view.pipelines.each do |pipeline| %>
    <tr class="govuk-table__row">
      <td class="govuk-table__cell">
        <a href="/group/<%= slugify(view.name) %>/pipeline/<%= slugify(pipeline.name) %>" class="govuk-link">
          <%= pipeline.name %>
        </a>
      </td>
      <td class="govuk-table__cell">
        <%= erb :'partials/label', :locals => {status: pipeline.status} %>
        <% if pipeline.paused %>
          <%= erb :'partials/label', :locals => {status: "Paused"} %>
        <% end %>
      </td>
      <td class="govuk-table__cell"><%= pipeline.current_stage_name if pipeline.is_running? %></td>
      <td class="govuk-table__cell">
          <%= erb :'partials/time', :locals => {
            time: pipeline.last_started_at,
            text: pipeline.is_running? ? pipeline.running_duration.human_str + " ago" : nil
          } %>
        </time>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>
